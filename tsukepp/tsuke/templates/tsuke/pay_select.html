{% extends "tsuke/base.html" %}
{% load static %}

{% block title %}支払う | Tsukepp{% endblock title %}

{% block contents %}
    <section id="about" class="about">
      <div class="container">
      <h2>支払うツケを選択してください。</h2>
      <div class="container">
        <table id="history" class="table table-hover">
          <thead>
            <tr>
              <th>支払う</th>
              <th>購入日時</th>
              <th>金額</th>
              <th>メモ</th>
            </tr>
          </thead>
          <tbody>
            {% for x in tsuke_list %}
              <tr>
                <td><input type="checkbox" name="pay" id="item{{forloop.counter}}" checked></td>
                <td>{{ x.purchase_datetime }}</td>
                <td>{{ x.amount }}</td>
                <td>{{ x.note }}</td>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <p>合計金額: <span id="total"></span> 円</p>
    </div>
    </section>
    <script> <!-- from ChatGPT -->
      // チェックボックスの要素を取得
      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      const totalDisplay = document.getElementById('total');
      const amountRowNo = 2  // FIXME: 本当は列名で指定したい

      // 合計を計算する関数
      function calculateTotal() {
        let total = 0;
        checkboxes.forEach(checkbox => {
          if (checkbox.checked) {
            const row = checkbox.parentNode.parentNode; // チェックボックスの親要素の親要素 (行) を取得
            const price = parseFloat(row.cells[amountRowNo].textContent); // 金額のセルのテキストを数値に変換

            total += price;
          }
        });

        // 合計を表示
        totalDisplay.textContent = total;
      }

      // チェックボックスの状態が変更されたときに合計を計算
      checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', calculateTotal);
      });
      calculateTotal();
    </script>
{% endblock contents %}
